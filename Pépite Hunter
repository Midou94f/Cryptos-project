############### P√©pites Hunter ###################


# Chargement des biblioth√®ques n√©cessaires
library(crayon)  # Pour les styles de couleur
library(dplyr)   # Pour la manipulation des donn√©es
library(ggplot2) # Pour les visualisations (si n√©cessaire)
library(httr)    # Pour les appels API
library(jsonlite) # Pour travailler avec les donn√©es JSON
library(curl)

# D√©finition des styles
question_style <- blue$bold
info_style <- white$italic
warning_style <- red$bold
success_style <- green$bold
highlight_style <- yellow$bold
info_secondary_style <- cyan$italic
error_style <- red$bold$underline
section_title_style <- magenta$bold$underline
pro_style <- red$bold  # Style pour PRO


################################################################################
#########                  LUNAR CRUSH (API Payante)
################################################################################

lunar_crush <- function() {
  # Message d'introduction
  cat(section_title_style("\nBienvenue sur LunarCrush - Analyse Crypto avanc√©e !\n"))
  cat(success_style("\n===========================================================\n"))
  cat(highlight_style("LunarCrush est une plateforme innovante qui fournit des analyses approfondies sur les cryptomonnaies. Voici ce qu'elle offre :\n"))
  
  cat("- ", info_style("Analyse des tendances sociales : D√©couvrez les cryptomonnaies les plus mentionn√©es sur les r√©seaux sociaux, identifiez les tendances √©mergentes et √©valuez l'int√©r√™t communautaire.\n"))
  cat("- ", info_style("Analyse des tendances de recherche : Obtenez un aper√ßu des recherches les plus populaires pour les cryptos sur diverses plateformes.\n"))
  cat("- ", info_style("AltRank : Classement unique qui combine l'activit√© sociale et les indicateurs de march√© pour √©valuer les opportunit√©s cach√©es.\n"))
  cat("- ", info_style("Galaxy Score : Un score exclusif bas√© sur une combinaison de donn√©es sociales, de march√© et techniques pour mesurer la sant√© et la qualit√© d'une crypto.\n"))
  
  cat(success_style("\n===========================================================\n"))
  
  # Message indiquant que l'outil est en pause
  cat(warning_style("\nActuellement, notre outil est en cours de d√©veloppement car l'API LunarCrush n√©cessite un abonnement payant.\n"))
  cat(warning_style("\nLa construction de cet outil est donc temporairement en pause.\n"))
  
  # Menu principal pour LunarCrush
  repeat {
    cat(section_title_style("\n=== Menu LunarCrush ===\n"))
    options <- c(
      "Revenir au menu P√©pitesHunter",
      "Analyse des tendances sociales",
      "Analyse des tendances de recherche",
      "AltRank",
      "Galaxy Score"
    )
    
    for (i in seq_along(options)) {
      cat(paste0(i, ". ", options[i], "\n"))
    }
    
    choix <- readline(question_style("Veuillez choisir une option (par num√©ro) : "))
    
    if (choix == "1") {
      cat(info_style("\nRetour au menu P√©pitesHunter...\n"))
      break
    } else if (choix %in% c("2", "3", "4", "5")) {
      option <- options[as.numeric(choix)]
      cat(success_style(paste0("\nVous avez choisi : ", option, "\n")))
      
      # Explication sp√©cifique √† chaque option
      if (option == "Analyse des tendances sociales") {
        cat(info_style("\nL'analyse des tendances sociales vous permet de rep√©rer les cryptomonnaies les plus mentionn√©es sur les r√©seaux sociaux. Ces informations peuvent aider √† identifier des opportunit√©s avant qu'elles ne deviennent mainstream.\n"))
      } else if (option == "Analyse des tendances de recherche") {
        cat(info_style("\nCette option analyse les termes de recherche pour les cryptos, ce qui peut indiquer un int√©r√™t croissant ou une tendance en d√©veloppement.\n"))
      } else if (option == "AltRank") {
        cat(info_style("\nAltRank combine l'activit√© sociale et les indicateurs de march√© pour classer les cryptos, en mettant en lumi√®re celles qui ont un potentiel cach√©.\n"))
      } else if (option == "Galaxy Score") {
        cat(info_style("\nGalaxy Score est un indicateur unique qui √©value la sant√© globale et la qualit√© d'une crypto en fonction de donn√©es sociales, de march√© et techniques.\n"))
      }
      
      # Message indiquant que la fonctionnalit√© est indisponible
      cat(warning_style("\nCette fonctionnalit√© est en cours de construction.\n"))
      cat(warning_style("\nMalheureusement, l'API LunarCrush est payante et n√©cessite un abonnement.\n"))
    } else {
      cat(warning_style("\nChoix invalide. Veuillez r√©essayer.\n"))
    }
  }
}

# Appel √† la fonction principale
lunar_crush()


################################################################################
#########                  Santiment (API Payante)
################################################################################

santiment <- function() {
  # Message d'introduction
  cat(section_title_style("\nBienvenue sur Santiment - Analyse Crypto avanc√©e !\n"))
  cat(success_style("\n===========================================================\n"))
  cat(highlight_style("Santiment est une plateforme sp√©cialis√©e dans l'analyse des cryptomonnaies, ax√©e sur quatre types de donn√©es principales :\n"))
  
  cat("- ", info_style("Donn√©es on-chain : Cela inclut les transactions en temps r√©el, les flux d'√©changes, et les donn√©es blockchain pertinentes. Ces analyses permettent d'identifier les mouvements de \"whales\" (grands d√©tenteurs de crypto) ou des changements inhabituels dans les activit√©s on-chain.\n"))
  cat("- ", info_style("Signaux sociaux : Analyse des discussions sur les r√©seaux sociaux pour d√©tecter les tendances √©mergentes et les sentiments autour des cryptomonnaies.\n"))
  cat("- ", info_style("Analyse de sentiment de march√© : Utilise des m√©triques pour comprendre si le sentiment global des investisseurs est optimiste, pessimiste ou neutre.\n"))
  cat("- ", info_style("Donn√©es de d√©veloppement : Donn√©es sur l'activit√© des d√©veloppeurs des projets blockchain, incluant les commits GitHub ou l'√©volution des projets techniques.\n"))
  
  cat(success_style("\n===========================================================\n"))
  
  # Message indiquant que l'outil est en pause
  cat(warning_style("\nActuellement, cet outil est en cours de d√©veloppement car l'API Santiment n√©cessite un abonnement payant.\n"))
  cat(warning_style("\nLa construction de cet outil est donc temporairement en pause.\n"))
  
  # Menu principal pour Santiment
  repeat {
    cat(section_title_style("\n=== Menu Santiment ===\n"))
    options <- c(
      "Revenir au menu P√©pitesHunter",
      "Analyse des donn√©es on-chain",
      "Analyse des signaux sociaux",
      "Analyse du sentiment de march√©",
      "Suivi des donn√©es de d√©veloppement"
    )
    
    for (i in seq_along(options)) {
      cat(paste0(i, ". ", options[i], "\n"))
    }
    
    choix <- readline(question_style("Veuillez choisir une option (par num√©ro) : "))
    
    if (choix == "1") {
      cat(info_style("\nRetour au menu P√©pitesHunter...\n"))
      break
    } else if (choix %in% c("2", "3", "4", "5")) {
      option <- options[as.numeric(choix)]
      cat(success_style(paste0("\nVous avez choisi : ", option, "\n")))
      cat(warning_style("\nCette fonctionnalit√© est en cours de construction.\n"))
      cat(warning_style("\nMalheureusement, l'API Santiment est payante et n√©cessite un abonnement.\n"))
    } else {
      cat(warning_style("\nChoix invalide. Veuillez r√©essayer.\n"))
    }
  }
}

# Appel √† la fonction principale
santiment()

################################################################################
############## COIN GECKO
#################################################################################

#############################
# Dataframe global pour stocker les donn√©es
coingecko_data <- NULL

# Fonction pour t√©l√©charger les donn√©es depuis CoinGecko
download_coingecko_data <- function() {
  url <- "https://api.coingecko.com/api/v3/coins/markets"
  params <- list(
    vs_currency = "usd",
    order = "market_cap_desc",
    per_page = 250,
    page = 1,
    sparkline = FALSE
  )
  
  response <- GET(url, query = params)
  
  if (status_code(response) == 200) {
    data <- fromJSON(content(response, "text", encoding = "UTF-8"))
    assign("coingecko_data", data, envir = .GlobalEnv)
    cat(success_style("\nDonn√©es t√©l√©charg√©es avec succ√®s depuis CoinGecko !\n"))
  } else {
    cat(error_style("\nErreur lors de la r√©cup√©ration des donn√©es depuis CoinGecko. V√©rifiez votre connexion ou les param√®tres API.\n"))
    assign("coingecko_data", NULL, envir = .GlobalEnv)
  }
}

####################################################
# Fonction corrig√©e pour afficher un tableau avec colonnes fixes et couleurs
display_table_fixed_colored <- function(data, title) {
  # Largeurs fixes pour chaque colonne
  col_widths <- c(40, 15, 10)  # Largeurs pour chaque colonne
  
  # Fonction pour tronquer ou remplir les colonnes
  format_column <- function(column, width) {
    sapply(column, function(x) {
      x <- substr(x, 1, width)  # Tronque les cha√Ænes trop longues
      sprintf(paste0("%-", width, "s"), x)  # Ajoute des espaces si n√©cessaire
    })
  }
  
  # Formater les en-t√™tes
  header <- sprintf(
    "%-*s | %-*s | %-*s",
    col_widths[1], "Nom",
    col_widths[2], "Symbole",
    col_widths[3], "Variation"
  )
  
  # Formater les donn√©es
  formatted_data <- data.frame(
    Nom = format_column(data$name, col_widths[1]),
    Symbole = format_column(data$symbol, col_widths[2]),
    Variation = format_column(data$price_change_percentage_24h, col_widths[3])
  )
  
  # Appliquer des couleurs aux donn√©es
  formatted_data$Nom <- cli::col_cyan(formatted_data$Nom)
  formatted_data$Symbole <- cli::col_yellow(formatted_data$Symbole)
  formatted_data$Variation <- ifelse(
    as.numeric(gsub("%", "", data$price_change_percentage_24h)) >= 0,
    cli::col_green(formatted_data$Variation),  # Vert pour positif
    cli::col_red(formatted_data$Variation)    # Rouge pour n√©gatif
  )
  
  # Afficher le titre
  cat(cli::col_magenta(title), "\n")
  
  # Afficher les en-t√™tes
  cat(header, "\n")
  
  # Ligne de s√©paration
  cat(paste0(rep("-", sum(col_widths) + 6), collapse = ""), "\n")
  
  # Afficher chaque ligne de donn√©es
  for (i in 1:nrow(formatted_data)) {
    cat(sprintf(
      "%-*s | %-*s | %-*s\n",
      col_widths[1], formatted_data$Nom[i],
      col_widths[2], formatted_data$Symbole[i],
      col_widths[3], formatted_data$Variation[i]
    ))
  }
}


##########################################################
# Fonction pour analyser les variations de prix
process_price_signals <- function(data) {
  cat(section_title_style("\n=== Signal Prix ===\n"))
  
  cat(info_style("\nDans cette section, vous trouverez les "))
  cat(highlight_style("d√©tails des variations de prix des cryptomonnaies sur les derni√®res 24 heures"))
  cat(info_style(", tri√©es selon diff√©rents crit√®res pour une analyse pr√©cise et rapide.\n\n"))
  
  cat(success_style("=== Organisation des donn√©es : ===\n"))
  cat(info_style("- Les cryptomonnaies ayant connu "))
  cat(success_style("les plus fortes progressions"))
  cat(info_style(" sur 24 heures sont list√©es par ordre d√©croissant.\n"))
  cat(info_style("- Les cryptomonnaies ayant enregistr√© "))
  cat(warning_style("les plus fortes baisses"))
  cat(info_style(" sont tri√©es par ordre croissant.\n"))
  cat(info_style("- Nous mettons √©galement en avant un classement des "))
  cat(highlight_style("10 meilleures performances"))
  cat(info_style(" et des "))
  cat(highlight_style("10 pires performances"))
  cat(info_style(", pour identifier rapidement les signaux les plus marquants.\n\n"))
  
  cat(success_style("=== Source des donn√©es : ===\n"))
  cat(info_style("Les donn√©es affich√©es ici proviennent de "))
  cat(highlight_style("l'API CoinGecko"))
  cat(info_style(", une r√©f√©rence mondiale en mati√®re d‚Äôinformations sur les cryptomonnaies. Elles sont collect√©es et mises √† jour r√©guli√®rement pour garantir leur fiabilit√©.\n\n"))
  
  cat(success_style("=== Pr√©sentation des r√©sultats : ===\n"))
  cat(info_style("Les donn√©es sont organis√©es sous forme de tableaux contenant les informations suivantes :\n"))
  cat(info_style("- "))
  cat(highlight_style("Nom de la cryptomonnaie"))
  cat(info_style(" : Identification de l‚Äôactif.\n"))
  cat(info_style("- "))
  cat(highlight_style("Symbole"))
  cat(info_style(" : Abr√©viation officielle (par exemple, BTC pour Bitcoin).\n"))
  cat(info_style("- "))
  cat(highlight_style("Variation de prix sur 24h"))
  cat(info_style(" : Exprim√©e en pourcentage, arrondie √† deux d√©cimales pour plus de clart√©.\n\n"))
  
  cat(success_style("=== Structure des r√©sultats affich√©s : ===\n"))
  cat(info_style("1. "))
  cat(highlight_style("Top 50 Progressions"))
  cat(info_style(" : Liste des cryptomonnaies ayant enregistr√© les plus fortes hausses de prix.\n"))
  cat(info_style("2. "))
  cat(highlight_style("Top 50 Baisse"))
  cat(info_style(" : Liste des cryptomonnaies ayant subi les plus fortes baisses.\n"))
  cat(info_style("3. "))
  cat(highlight_style("Signaux Haussiers (Top 10)"))
  cat(info_style(" : Les 10 actifs les plus performants.\n"))
  cat(info_style("4. "))
  cat(highlight_style("Signaux Baissiers (Top 10)"))
  cat(info_style(" : Les 10 actifs ayant connu les plus grandes baisses.\n\n"))
  
  cat(warning_style("Note : "))
  cat(info_style("Ces donn√©es fournissent une vue d‚Äôensemble claire des mouvements r√©cents sur les 24 derni√®res heures.\n\n"))
  
  ############
  
  if (is.null(data) || nrow(data) == 0) {
    cat(error_style("\nErreur : Les donn√©es ne sont pas disponibles. Veuillez v√©rifier l'appel API.\n"))
    return()
  }
  
  ################## 
  # Nettoyage et pr√©paration des donn√©es
  cleaned_data <- data %>%
    select(name, symbol, price_change_percentage_24h) %>%
    mutate(
      price_change_percentage_24h = paste0(round(as.numeric(price_change_percentage_24h), 2), "%")
    )
  
  # Top 50 Progressions
  display_table_fixed_colored(
    cleaned_data %>% arrange(desc(as.numeric(gsub("%", "", price_change_percentage_24h)))) %>% head(50),
    "Tableau des variations en % des derni√®res 24 heures : Top 50 Progressions "
  )
  cat(cli::col_green("\nCe tableau pr√©sente les cryptomonnaies ayant enregistr√© les meilleures progressions sur les derni√®res 24 heures.\n\n"))
  
  # Top 50 Baisses
  display_table_fixed_colored(
    cleaned_data %>% arrange(as.numeric(gsub("%", "", price_change_percentage_24h))) %>% head(50),
    "Tableau des variations en % des derni√®res 24 heures : Top 50 Baisses"
  )
  cat(cli::col_red("\nCe tableau pr√©sente les cryptomonnaies ayant subi les plus fortes baisses sur les derni√®res 24 heures.\n\n"))
  
  # Signaux Haussiers (Top 10)
  display_table_fixed_colored(
    cleaned_data %>% arrange(desc(as.numeric(gsub("%", "", price_change_percentage_24h)))) %>% head(10),
    "Tableau des Signaux Haussiers (Top 10)"
  )
  cat(cli::col_green("\nLes 10 cryptomonnaies les plus performantes √† surveiller.\n\n"))
  
  # Signaux Baissiers (Top 10)
  display_table_fixed_colored(
    cleaned_data %>% arrange(as.numeric(gsub("%", "", price_change_percentage_24h))) %>% head(10),
    "Tableau des Signaux Baissiers (Top 10)"
  )
  cat(cli::col_red("\nLes 10 cryptomonnaies ayant subi les plus fortes baisses.\n"))
  
}

################################################################################
# Fonction principale pour g√©rer le menu
coingecko <- function() {
  cat(section_title_style("\n D√©tection des p√©pites via CoinGecko - outils d'analyse !\n"))
  cat(success_style("\n===========================================================\n"))
  cat(highlight_style("\nExplorez les signaux prix, volumes, niches et tendances des cryptomonnaies!\n"))
  cat(success_style("===========================================================\n"))
  
  # T√©l√©charger les donn√©es une fois au d√©but
  download_coingecko_data()
  
  # V√©rifier si les donn√©es ont √©t√© correctement t√©l√©charg√©es
  if (is.null(coingecko_data) || nrow(coingecko_data) == 0) {
    cat(error_style("\nImpossible de continuer : les donn√©es n'ont pas √©t√© t√©l√©charg√©es correctement.\n"))
    return()
  }
  
  repeat {
    cat(section_title_style("\n=== Menu CoinGecko ===\n"))
    options <- c(
      "Revenir au menu P√©pitesHunter",
      "Signal Prix",
      "Volume et Trading (non impl√©ment√©)",
      "Classement par Capitalisation Boursi√®re (non impl√©ment√©)"
    )
    
    for (i in seq_along(options)) {
      cat(paste0(i, ". ", options[i], "\n"))
    }
    
    choix <- readline(question_style("Veuillez choisir une option (par num√©ro) : "))
    
    if (choix == "1") {
      cat(info_style("\nRetour au menu P√©pitesHunter...\n"))
      break
    } else if (choix == "2") {
      process_price_signals(coingecko_data)
    } else if (choix %in% c("3", "4")) {
      cat(warning_style("\nCette fonctionnalit√© n'est pas encore impl√©ment√©e.\n"))
    } else {
      cat(warning_style("\nChoix invalide. Veuillez r√©essayer.\n"))
    }
  }
}

# Appel √† la fonction principale
coingecko()

################################################################################
###########@################### MENU PEPITE ###############
################################################################################

# D√©finition de P√©pitesHunter
pepite_hunter <- function() {
  cat(section_title_style("\nP√©pitesHunter - Cryptowise Copilote :\n"))
  cat(success_style("\n===========================================================\n"))
  cat(highlight_style("Bienvenue sur votre outil unique pour d√©tecter les signaux de probable run sur des cryptomonnaies prometteuses.\n"))
  cat(highlight_style("\nAvec P√©pitesHunter, vous pouvez :\n"))
  cat("- Analyser les cryptos les plus recherch√©es sur diff√©rentes plateformes.\n")
  cat("- Observer leur progression sur plusieurs p√©riodes temporelles.\n")
  cat("- Identifier les mouvements potentiels avant qu'ils ne deviennent des tendances majeures.\n")
  cat(success_style("===========================================================\n"))
  
  cat(section_title_style("\nPlateformes disponibles :\n"))
  
  # Liste des plateformes avec leurs descriptions
  platforms <- list(
    "\nLunar Crush" = "Analyse les tendances sociales et fournit des insights sur les interactions en ligne autour des cryptomonnaies.",
    "\nCoinGecko" = "Fournit des donn√©es compl√®tes sur les prix, volumes, et autres m√©triques du march√© crypto.",
    "\nGoogle Trend" = "Explore les recherches Google pour identifier les cryptos suscitant un int√©r√™t croissant.",
    "\nCoin Market Cap" = "Propose un classement exhaustif des cryptomonnaies avec des indicateurs de march√© cl√©s.",
    "\nMessari" = "Plateforme d'analyse pour les donn√©es de march√© et les recherches approfondies sur les cryptos.",
    "\nSantiment" = "Se concentre sur les donn√©es on-chain, les signaux sociaux et le sentiment du march√©."
  )
  
  # Affichage des plateformes avec styles
  for (platform in names(platforms)) {
    cat(info_secondary_style(platform), ":", info_style(platforms[[platform]]), "\n")
    cat("\n")  # Espacement pour meilleure lisibilit√©
  }
  
  # Menu des outils P√©pitesHunter
  repeat {
    cat(section_title_style("\n=== Menu des outils P√©pitesHunter ===\n"))
    options <- c(
      "Lunar Crush (Restreinte)",
      "CoinGecko",
      "Google Trend",
      "Coin Market Cap",
      "Messari",
      "Santiment",
      "Revenir au menu principal"
    )
    
    for (i in seq_along(options)) {
      cat(paste0(i, ". ", options[i], "\n"))
    }
    
    choix <- readline(question_style("Veuillez choisir une plateforme (par num√©ro) : "))
    
    if (choix %in% c("1", "2", "3", "4", "5", "6")) {
      platform <- options[as.numeric(choix)]
      cat(success_style(paste0("\nVous avez choisi : ", platform, "\n")))
      
      # Message personnalis√© pour chaque plateforme
      if (platform == "Lunar Crush") {
        cat(highlight_style("\nPlongez dans les signaux sociaux et les tendances en ligne gr√¢ce √† Lunar Crush ! üöÄ\n"))
      } else if (platform == "CoinGecko") {
        cat(highlight_style("\nD√©couvrez les donn√©es compl√®tes sur les cryptos avec CoinGecko.\n"))
      } else if (platform == "Google Trend") {
        cat(highlight_style("\nAnalysez les recherches Google pour rep√©rer les cryptos qui attirent l'attention.\n"))
      } else if (platform == "Coin Market Cap") {
        cat(highlight_style("\nExplorez le classement et les indicateurs cl√©s avec Coin Market Cap.\n"))
      } else if (platform == "Messari") {
        cat(highlight_style("\nApprofondissez vos analyses gr√¢ce aux donn√©es riches de Messari.\n"))
      } else if (platform == "Santiment") {
        cat(highlight_style("\nExaminez les signaux sociaux et les donn√©es on-chain via Santiment.\n"))
      }
      
      # Placeholder pour impl√©mentation sp√©cifique
      cat(info_style("\nCette fonctionnalit√© sera bient√¥t disponible.\n"))
      
    } else if (choix == "7") {
      cat(info_style("\nRetour au menu principal...\n"))
      break
    } else {
      cat(warning_style("\nChoix invalide. Veuillez r√©essayer.\n"))
    }
  }
}

# Appel √† la fonction P√©pitesHunter
pepite_hunter()
